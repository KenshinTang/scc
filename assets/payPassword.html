<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta content="width=device-width,initial-scale=1.0,user-scalable=no" name="viewport">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="format-detection" content="telephone=no,email=no,adress=no" />

    <title>输入支付密码</title>

    <link rel="stylesheet" href="css/g.css">
    <link rel="stylesheet" href="css/comm.css">
    <link rel="stylesheet" href="css/zhifu.css">

    <style>
        .bg_keyboard {
            background-color: #D1D2D6;
        }

        section {
            position: relative;
        }

        .sureBtn {
            margin-top: 30px;
        }
    </style>

</head>

<!--******************************************************************************-->

<body>

    <header>
        <div class="navBar">
            <div class="navBackIcon" onclick="Comm.close()"></div>
            <div class="navTitle"></div>
        </div>
    </header>
    <!--******************************************************************************-->

    <section class="bg_white">

        <div class="ftc_wzsf" style="display: block;">

            <div class="srzfmm_box">

                <div class="scroll-y mainH mainW">

                    <div class="zfmmxx_shop ph40">
                        <div class="mz">请输支付密码</div>
                        <div id="totalMoney" class="zhifu_price pt40">￥0</div>
                    </div>

                    <ul class="mm_box">
                        <li data="" class=""></li>
                        <li data="" class=""></li>
                        <li data="" class=""></li>
                        <li data="" class=""></li>
                        <li data="" class=""></li>
                        <li data="" class=""></li>
                    </ul>


                    <div class="bg_trans lh50 br5 m10 center col_white f18 sureBtn" onclick="submitSurePay();">确认</div>

                </div>

            </div>


            <div class="numb_box bg_keyboard" style="display: block;">
                <div class="xiaq_tb" style="background-color: #f5f5f5;">
                    <img src="img/generalIcon/jftc_14.jpg" height="10">
                </div>
                <ul class="nub_ggg">
                    <li><a href="javascript:void(0);" class="zf_num">1</a></li>
                    <li><a href="javascript:void(0);" class="zj_x zf_num">2</a></li>
                    <li><a href="javascript:void(0);" class="zf_num">3</a></li>
                    <li><a href="javascript:void(0);" class="zf_num">4</a></li>
                    <li><a href="javascript:void(0);" class="zj_x zf_num">5</a></li>
                    <li><a href="javascript:void(0);" class="zf_num">6</a></li>
                    <li><a href="javascript:void(0);" class="zf_num">7</a></li>
                    <li><a href="javascript:void(0);" class="zj_x zf_num">8</a></li>
                    <li><a href="javascript:void(0);" class="zf_num">9</a></li>
                    <li><a href="javascript:void(0);" class="zf_empty">清空</a></li>
                    <li><a href="javascript:void(0);" class="zj_x zf_num">0</a></li>
                    <li><a href="javascript:void(0);" class="zf_del">删除</a></li>
                </ul>
            </div>
            <!--<div class="hbbj"></div>-->

        </div>


    </section>

    <!--******************************************************************************-->
    <footer></footer>

    <script src="js/z.js"></script>
    <script src="js/g.js"></script>
    <script src="js/comm.js"></script>
    <script src="js/api.js"></script>
    <script src="inc/ewm/jquery-1.11.1.js"></script>

    <script>
        var payInfo = Comm.db('payInfo') || {};
        Comm.db('payInfo', null);
        var pwd;

        function pageload() {
            var type = payInfo.type;
            if (type == 'shop') {
                $('#totalMoney').html(app.price(payInfo.data.money));
            } else if (type == 'order' || type == 'sorder') {
                $('#totalMoney').html(app.price(payInfo.data.totalMoney));
            } else {
                Comm.close();
            }

        }

        $(function () {
            //出现浮动层
            $(".ljzf_but").click(function () {
                $(".ftc_wzsf").show();
            });
            //关闭浮动
            $(".close").click(function () {
                $(".ftc_wzsf").hide();
                $(".mm_box li").removeClass("mmdd");
                $(".mm_box li").attr("data", "");
                i = 0;
            });
            //数字显示隐藏
            $(".xiaq_tb").click(function () {
                showKeyboardBar(false);
            });
            $(".mm_box").click(function () {
                showKeyboardBar(true);
            });
            //----
            var i = 0;
            $(".nub_ggg li .zf_num").click(function () {
                if (i < 6) {
                    $(".mm_box li").eq(i).addClass("mmdd");
                    $(".mm_box li").eq(i).attr("data", $(this).text());
                    i++
                    if (i == 6) {
                        setTimeout(function () {
                            var data = "";
                            $(".mm_box li").each(function () {
                                data += $(this).attr("data");
                            });
                            pwd = data;
                            showKeyboardBar(false);
                        }, 100);
                    };
                }
            });

            $(".nub_ggg li .zf_del").click(function () {
                if (i > 0) {
                    i--
                    $(".mm_box li").eq(i).removeClass("mmdd");
                    $(".mm_box li").eq(i).attr("data", "");
                }
            });

            $(".nub_ggg li .zf_empty").click(function () {
                $(".mm_box li").removeClass("mmdd");
                $(".mm_box li").attr("data", "");
                i = 0;
            });



            function showKeyboardBar(show) {
                if (show){
                    $(".numb_box").slideDown(300);
                    $('.srzfmm_box').removeClass('dismiss')
                } else {
                    $(".numb_box").slideUp(300);
                    $('.srzfmm_box').addClass('dismiss')
                }
            }


        });


        function submitSurePay() {
            preventRepeadClickDeal(function () {
                payTypeDeal();
            }, 1)
        }


        function payTypeDeal() {
            if (!pwd || pwd.length != 6) {
                Comm.message('请输入完整的密码');
                return;
            }

            var type = payInfo.type;
            var parms = payInfo.data || {};
            parms.payPassword = pwd;
            if (parms.money) {
                if (parms.money % 1 != 0) {
                    parms.money = (parms.money).toFixed(0);
                }
            }
            if (parms.price) {
                if (parms.price % 1 != 0) {
                    parms.price = (parms.price).toFixed(0);
                }
            }

            if (type == 'shop') {
                Comm.loading(1);
                SLNetwork('post', '/api/store/saveStoreMoney', parms, function (a) {
                    Comm.loading();
                    if (a.code == 1) {
                        Comm.go('payComplect.html?type=FK');
                    } else {
                        Comm.message(a.msg);
                    }
                });

            } else if (type == 'order' || type == 'sorder') {

                parms.payPassword = pwd;
                parms.payType = 4;


                Comm.loading('正在支付...')
                AJAX.POST('/api/shoppingMall/order/pay', parms, function (a) {
                    Comm.loading();
                    if (a.code == 1) {
                        Comm.go('payComplect.html?type=DD&oid=' + parms.ordersId);
                    } else {
                        Comm.message(a.msg);
                    }
                });
            }


        }
    </script>

</body>

</html>