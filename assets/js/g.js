/*
ÈÉ®ÁΩ≤Âª∫ËÆÆÔºö
ÂÖ®Â±ÄÂºïÁî®zepto.js,g.js,comm.css
ÂêÑËá™ÁΩëÁ´ô‰∏≠ÂàõÂª∫Ëá™Â∑±ÁöÑÂÖ®Â±ÄJS,ÂíåÂÖ¨Áî®css
ÂÖ®Â±ÄJS‰∏≠ÈúÄË¶ÅÁî≥ÊòéconfigÂØπË±°Âπ∂Áî≥ÊòéÂ±ûÊÄß
	rootÔºöÊé•Âè£Ê†πË∑ØÂæÑurl
	webroot:ÊµãËØïÁΩëÈ°µÊé•Âè£
	isTest:ÊòØÂê¶ÊµãËØïÔºàÂºÄÂèë‰∏∫trueÔºå‰∏äÁ∫ø‰∏∫falseÔºâ
	ossroot:ossÊ†πË∑ØÂæÑ
Â¶ÇÊûúÊúâÂ§öÈ°µÈù¢ÂÖ±Áî®Ê†∑ÂºèÊàñjsËØ∑‰ΩøÁî®Áã¨Á´ãÊñá‰ª∂Â≠òÊîæÔºåÂ¶ÇÊûúÂêÑ‰∏™È°µÈù¢ÂêÑËá™Áã¨Á´ãÁöÑjsÊàñÊ†∑ÂºèÔºåÁõ¥Êé•ÂÜôÂú®È°µÈù¢‰∏≠
È°µÈù¢‰∫ã‰ª∂Ôºå
pageload:È°µÈù¢Âä†ËΩΩÊó∂ÊâßË°å
pageresumeÔºöÈ°µÈù¢ÈáçÊñ∞Ëé∑ÂæóÁÑ¶ÁÇπÊó∂ÊâßË°å
androidbackÔºöÂΩìÈù¢ÂÆâÂçìÁî®Êà∑ÁÇπÂáªËøîÂõûÈîÆÊó∂ÊâßË°åÔºåÂ¶ÇÊûúÈ°µÈù¢Ë∞ÉÁî®ÔºöComm.setAndroidHomeÔºàÔºâÈ°µÈù¢ÊâßË°åËØ¢ÈóÆÈÄÄÂá∫Êìç‰Ωú

Comm.go('index.html')
Comm.gotop('index.html')
Comm.goself('my.html')

Comm.close(2)

Comm.alert(1,function(a){

})
Comm.confim(1,function(a){
    if(a){
        ok
    }
})

Comm.loading(0)

db:‰∏äÁ∫ßÊìç‰ΩúÈ°µÈù¢ËøîÂõûÁöÑÊï∞ÊçÆ Comm.db('d',data)  Comm.db('d')
ÁâπÂà´ËØ¥ÊòéÔºöÁ≥ªÁªüÂÜÖÁΩÆÂèòÈáèÂùá‰∏∫‰ª•Âèå‰∏ãÂàíÁ∫ø ‚Äú__‚ÄùÂºÄÂßãÔºå‰∏∫Èò≤Ê≠¢ÂèòÈáèÊ±°ÊüìÔºåËØ∑‰∏çË¶ÅÂú®‰ªª‰ΩïÊó∂Èó¥Áî≥ÊòéÂèòÈáèÊó∂‰ΩøÁî®Âèå‰∏ãÂàíÁ∫øÂºÄÂßãÔºå
*/
var tempTimestamp = null;

var AJAX = new function () {
    var _xhr, K = "_token",
        abs = null,
        t = this;

    function finish(v, cb, url, parm) {
        if (cb == null) return;
        var o;
        if (v && v.length > 1) {

            try {
                if (!config.notDeal) {
                    v = v.replace(/</g, '&lt;').replace(/>/g, '&gt;');
                }
                o = JSON.parse(v);
                if (o.code == 110) {
                    {
                        var nowTimestamp = new Date().getTime();
                        if (tempTimestamp && nowTimestamp - tempTimestamp <= 1000) {
                            return;
                        }
                        tempTimestamp = nowTimestamp;
                        console.log('üëøüëøüëøüëøüëøüëøüëøüëøüëøüëøüëøüëøüëøüëøüëøüëø')
                        console.log('\nurl = \n' + url);
                        console.log('\nÂèÇÊï∞ = \n' + parm);
                        console.log('üëøüëøüëøüëøüëøüëøüëøüëøüëøüëøüëøüëøüëøüëøüëøüëø')

                        exitToken();
                        clearUserData();
                        Comm.alert("ÂΩìÂâçÁî®Êà∑ÁôªÂΩïÂ∑≤ËøáÊúü" + (config.SLTest ? '(Êã¨Âè∑ÈáåÈù¢ÊòØÊµãËØïÁöÑÊ≠£ÂºèÂèëÂåÖ‰∏ç‰ºöÊúâg.js)' : ''), function () {
                            Comm.goLogin();
                        });
                    }
                    return;
                }
                cb(o);
            } catch (e) {
                console.log("try:" + e);
                o = v;
                Comm.message(e);
            }
        }
    }

    function ab() {
        if (abs == null) {
            abs = Comm.db(K);
            if (abs == null)
                abs = '';
        }
        return abs;
    }

    function repair(api) {
        var a = ab();
        if (a) api += (api.indexOf('?') > 0 ? '&' : '?') + K + '=' + a + '&timespan=' + Math.random() + '&_device=1';
        return api;
    }

    function deobj(obj) {
        if (obj == null) return '';
        var s = [];
        for (var i in obj) {
            if (typeof(obj[i]) == typeof('')) {
                if (obj[i].indexOf('%') > 0)
                    obj[i] = obj[i].replace(/%/g, "%25");
                if (obj[i].indexOf('&') > 0)
                    obj[i] = obj[i].replace(/\&/g, "%26");
                if (obj[i].indexOf('+') > 0)
                    obj[i] = obj[i].replace(/\+/g, "%2B");
            }
            s.push(i + '=' + obj[i])
        }
        return s.join('&');
    }

    function error(code, cb) {
        Comm.loading();
        // if (window){
        //    cb && cb({
        //        code: -1,
        //        msg: 'ÊúçÂä°Âô®ÂºÇÂ∏∏'
        //    });
        // }

    }

    function init(post, url, data, cb) {
        url = t.Uri() + repair(url);
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
            if (this.readyState == 4) {
                if (this.status == 200) {
                    finish(this.responseText, cb, url, data);
                } else {
                    error(this.status, cb);
                }
            }
        };
        xhr.open(post ? 'POST' : 'GET', url, true);
        if (post) {
            data = deobj(data);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        }

        xhr.send(data);
    }

    /*----AJAXÂÖ¨Áî®ÊñπÊ≥ï-----*/

    /*Ëé∑ÂèñÊúçÂä°Âô®Êé•Âè£Ê†πË∑ØÂæÑ*/
    t.Uri = function () {
        return (window['config'] && window['config']['root']) ? config.root : '';
    }

    /*Ëé∑ÂèñÊúçÂä°Âô®Ë∞ÉËØïÈ°µÈù¢Ê†πË∑ØÂæÑ*/
    t.WebRoot = function () {
        return (window['config'] && window['config']['webroot']) ? config.webroot : '';
    }

    /*Ë∞ÉÁî®Áî®Êà∑ÁôªÂΩïtoken*/
    t.setTag = function (a) {
        abs = a;
        Comm.db(K, abs);
    }

    /*ÊâßË°åGETÊñπÊ≥ïÔºå‰∏ÄËà¨Áî®‰∫é‰ªéÊúçÂä°Âô®Ëé∑ÂèñÊï∞ÊçÆÔºåapiÈïøÂ∫¶Â∞ΩÈáè‰∏çË∂ÖËøá1000Â≠óËäÇ*/
    t.GET = function (api, cb) {
        init(false, api, null, cb);
    }
    /*ÊâßË°åPOSTÊñπÊ≥ïÔºå‰∏ÄËà¨Áî®‰∫éÂêëÊúçÂä°Âô®Êèê‰∫§Êï∞ÊçÆÔºådata jsonÂª∫ËÆÆ‰∏ç‰∏∫Á©∫*/
    t.POST = function (api, data, cb) {
        init(true, api, data, cb);
    }
    /*Ê†πÊçÆÁî®Êà∑Âá≠ËØÅÂà§Êñ≠Áî®Êà∑ÊòØÂê¶ÁôªÂΩï*/
    t.isLogin = function () {
        return ab().length > 0;
    }
};

/*ÂìçÂ∫îandroidËøîÂõûÈîÆ,Á®ãÂ∫èÂèØÈáçÂÜôÊ≠§‰∫ã‰ª∂Ôºå‰∏çÂèØÈáçÂÜôÔºåÂàôÊâßË°åÈªòËÆ§‰∫ã‰ª∂ÔºöÂÖ≥Èó≠*/
function androidback() {
    if (parseInt(Comm._pageinfo.android_home) === 0) {
        Comm.close();
    } else {
        if (parseInt(Comm._pageinfo.android_home) === 1) {
            Comm._pageinfo.android_home = 2;
            Comm.confirm('ÊÇ®Á°ÆÂÆöË¶ÅÈÄÄÂá∫Â∫îÁî®Ôºü', function (a) {
                if (a == 1)
                    Comm.close();
                else
                    Comm._pageinfo.android_home = 1;
            });
        }
    }
}

/*ÂéüÁîüÁªü‰∏ÄÂõûË∞ÉÔºåÁ≥ªÁªüÂÜÖÁΩÆÂáΩÊï∞*/
function _w9_wcallback(data, code) {
    if (code == null || code === "null") return;
    code = parseInt(code);
    //Á≥ªÁªü‰∫ã‰ª∂
    if (code === 0) {
        //androidËøîÂõûÈîÆ
        if (data === 'back')
            Comm.exec('androidback');
        //È°µÈù¢ÈáçÊñ∞Ëé∑ÂæóÁÑ¶ÁÇπ
        else if (data === 'resume') {
            resumeAndroidKeyboard();
            Comm.exec('pageresume');
            //‰∫ã‰ª∂Á∫ßÂõûË∞É
            if (Comm._pageinfo.resume) {
                Comm._pageinfo.resume(bd);
                Comm._pageinfo.resume = null;
            }
        }
    }
    //ÂéüÁîü‰∫ã‰ª∂
    else if (code > 0) {
        var temp = Comm._pageinfo.e[code];
        if (temp) {
            delete Comm._pageinfo.e[code];
            temp.cb(temp.db ? Comm._deData(data) : Comm.parse(data));
            temp = null;
        }
    }
}


var Comm = new function () {
    //ÁΩëÈ°µÂéÜÂè≤ËÆ∞ÂΩï
    var URLIST = '__UrlList',
        z = this;

    //Â§ÑÁêÜÂéüÁîüÂõûË∞ÉË∑ØÁî±
    function callNative(m, d) {
        if (z.ios()) {
            var data = {
                method: m + (d === null ? '' : ':')
            };
            if (d) data['data'] = toStr(d || '');
            window.webkit.messageHandlers.WeiLai.postMessage(data);
        } else {
            if (window.WeiLai && (typeof window.WeiLai[m] === typeof
                function () {
                })) {
                if (d === null)
                    window.WeiLai[m]();
                else
                    window.WeiLai[m](toStr(d));
            }
        }
    }

    //ÂØπË±°ËΩ¨str
    function toStr(o) {
        if (typeof(o) == typeof({}))
            return JSON.stringify(o);
        return o;
    }

    //ËÆæÁΩÆ‰øùÁïôÂõûË∞ÉÊñπÊ≥ïÂπ∂ËøîÂõûÂè•ÊüÑ
    function setcb(cb, db) {
        if (!cb) return 0;
        var code = (++z._pageinfo.code);
        z._pageinfo.e[code] = {
            cb: cb,
            db: db
        };
        return code;
    }

    //Â≠òÂÇ®ÂØπË±°ÊàñÂÜÖÂÆπÊó∂ÁºñÁ†Å
    function enData(o) {
        return encodeURIComponent(JSON.stringify(o)).replace(/\%/g, "/");
    }

    //ÂèñÂá∫ÂØπË±°ÊàñÂÜÖÂÆπÊó∂Ëß£Á†ÅÔºåÁ≥ªÁªüÂÜÖÁΩÆÂáΩÊï∞
    z._deData = function (s) {
        if (s && s.indexOf('/') > -1) {
            s = decodeURIComponent(s.replace(/\//g, "%"));
        }
        return z.parse(s);
    }
    z._pageinfo = {
        android_home: 0,
        wback: null,
        code: 1,
        e: {},
        test: false
    };
    //Â∞ÅÈù¢ËÉåÊôØ
    var MainBg = {
        box: null,
        s: false,
        d: 0,
        init: function () {
            if (MainBg.box === null) {
                MainBg.box = document.createElement('DIV');
                MainBg.box.id = 'MainBg';
                $(document.body).prepend(MainBg.box);
                MainBg.box.addEventListener('touchstart', MainBg.noact, false);
                MainBg.box.addEventListener('touchmove', MainBg.noact, false);
            }
        },
        noact: function (e) {
            e.preventDefault();
            return false;
        },
        show: function (s) {
            if (s) {
                MainBg.d++;
                if (!MainBg.s) {
                    MainBg.init();
                    MainBg.s = true;
                    $(MainBg.box).show();
                }
            } else {
                MainBg.d--;
                if (MainBg.d <= 0 && MainBg.s) {
                    MainBg.d = 0;
                    MainBg.s = false;
                    $(MainBg.box).hide();
                }
            }
        },
        close: function () {
            MainBg.d = 1;
            MainBg.s = true;
            MainBg.show(false);
        }

    };
    //mess
    var Mess = {
        box: null,
        show: false,
        init: function () {
            if (Mess.box === null) {
                Mess.box = document.createElement('DIV');
                Mess.box.id = 'MessgeBox';
                Mess.box.innerHTML = '<div id="MessgeBoxContent"></div><div id="MessgeBoxButton" class="nowrap"></div>';
                document.body.appendChild(Mess.box);
            }
        },
        alert: function (mess, code) {
            Mess.init();
            $('#MessgeBoxContent').attr('class', 'center').html(mess);
            $('#MessgeBoxButton').html('<span class="mbuttonfull" ' + callbackstr(1, code) + '>Á°ÆÂÆö</span>');
            MainBg.show(true);
            Mess.show = true;
            $(Mess.box).show();
        },
        confirm: function (mess, code, o) {
            Mess.init();
            $('#MessgeBoxContent').attr('class', 'tleft').html(mess);
            $('#MessgeBoxButton').html('<span class="mbuttonl"' + callbackstr(0, code) +
                '>' + (o && o.c || 'ÂèñÊ∂à') + '</span><span class="mbuttonr"' + callbackstr(1, code) + '>' + (o && o.y || 'Á°ÆÂÆö') + '</span>');
            MainBg.show(true);
            Mess.show = true;
            $(Mess.box).show();
        },
        close: function () {
            if (Mess.show) {
                Mess.show = false;
                $(Mess.box).hide();
                MainBg.show(false);
            }
        }
    };
    //message
    var Message = {
        box: null,
        h: 0,
        init: function () {
            if (Message.box === null) {
                Message.box = document.createElement('DIV');
                Message.box.id = 'MessgeBoxT';
                document.body.appendChild(Message.box);
            }
        },
        show: function (mess) {
            clearTimeout(Message.h);
            Message.init();
            Message.box.innerHTML = '<span>' + mess + '</span>';
            $(Message.box).show();
            Message.h = setTimeout(function () {
                $(Message.box).hide();
                _w9_wcallback(1);
            }, 1500);
        }
    };

    //Áªü‰∏ÄÂõûË∞ÉÂ≠óÁ¨¶‰∏≤
    function callbackstr(d, code) {
        return ' onclick="Comm.callback(' + d + ',' + code + ')"';
    }

    //ÂµåÂÖ•ÂºπÁ™ó
    var WTD = new function () {
        var t = 'wtd',
            tl = null,
            box, cancel = false,
            bid = 'WTDBOX',
            cid = 'WTDBOXTD',
            wid = '_WTDBOX';

        function init(wtdid) {
            if (tl && tl[wtdid] === undefined || tl === null) {
                if (tl === null) {
                    box = document.createElement('div');
                    box.id = bid;
                    box.innerHTML = '<div id="' + wid + '"><div id="' + cid + '"></div></div>';
                    document.body.appendChild(box);
                }
                tl = {};
                $('*[' + t + ']').each(function (i, e) {
                    tl[$(e).attr(t)] = $(e).prop("outerHTML").replace("wtd", "showwtd");
                    //$(e).remove();
                });
            }
        }

        function show(wtdid, can) {
            init(wtdid);
            cancel = !!can;
            if (tl && tl[wtdid]) {
                Comm.bg(true);
                $('#' + bid).click(function (e) {
                    if (e.target.id === wid && cancel) hide();
                });
                $('#' + cid).html(tl[wtdid]);
                $(box).css('display', 'table');
            }
        }

        function hide() {
            if (box) {
                $('#' + cid).html('');
                $(box).css('display', 'none');
                Comm.bg(false);
            }
        }

        return {
            show: show,
            hide: hide
        };
    };
    //Âä†ËΩΩÂ±Ç
    var Loading = {
        box: null,
        init: function () {
            if (Loading.box === null) {
                Loading.box = document.createElement('div');
                Loading.box.id = 'loadingbox';
                document.body.appendChild(Loading.box);
            }
        },
        show: function (arg) {
            Loading.init();
            if (arg == null || !arg) {
                $(Loading.box).hide();
                Comm.bg();
            } else {
                Comm.bg(true);
                if (arg == true || arg == '') arg = 'Âä†ËΩΩ‰∏≠ÔºåËØ∑Á®çÂÄô...';
                $(Loading.box).html('<span>' + arg + '</span>');
                $(Loading.box).show();
            }
        }
    };
    /*--------------------ÂÖ¨ÂÖ±ÂáΩÊï∞-----------------------*/
    /*Â§ÑÁêÜÁ§∫Áî≥ÊòéÂØπË±°undefined*/
    z.un = function () {
        return 'undefined'
    };
    //Â∞ùËØïËΩ¨Âåñstr to json
    z.parse = function (s) {
        var o;
        try {
            o = JSON.parse(s);
        } catch (e) {
            o = s;
        }
        return o;
    };
    //Â∞ùËØïÊâßË°åÊ†πÊñπÊ≥ï
    z.exec = function (m) {
        if (window[m]) {
            var a = [];
            for (var i = 1; i < arguments.length; i++)
                a[i - 1] = arguments[i];
            window[m].apply(null, a);
        }
    };
    //Â§ÑÁêÜÁªü‰∏ÄÂõûË∞É‰∫ã‰ª∂
    z.callback = function (d, code) {
        if (Mess.show)
            Mess.close();
        _w9_wcallback(d, code);
    };
    //ÊòØÂê¶Â§ÑÁêÜÂæÆ‰ø°‰∏≠
    z.wx = function () {
        return navigator.userAgent.toLocaleLowerCase().indexOf('micromessenger') > -1
    };
    //ÊòØÂê¶ÊòØios
    z.ios = function () {
        return window.webkit != null && window.webkit.messageHandlers != null && !z.wx();
    };
    //ÊòØÂê¶‰∏∫ÂéüÁîüËøîÂõû true Ë°®Á§∫ÊòØÂéüÁîü
    z.w9 = function () {
        // return (z.ios());
        return (window['WeiLai'] || z.ios());
    };
    //ÈáçÂÜôgetElementById
    z.g = function (id) {
        return document.getElementById(id);
    };
    //‰ª£ÊõøJQ
    z.$1 = function (s) {
        return document.querySelector(s);
    };
    z.$ = function (s) {
        return document.querySelectorAll(s);
    };
    //Ëé∑ÂèñURLÊü•ËØ¢ÂèÇÊï∞,
    //Â¶ÇÊûúÊú™‰º†ÂÖ•ÂèÇÊï∞nÔºåÂàôËøîÂõûÊâÄÊúâÊü•ËØ¢ÂÜÖÂÆπ
    //Â¶ÇÊûúu,Êú™ÊåáÂÆöÔºåÂàôÂèñÊú¨È°µÂú∞ÂùÄ
    z.query = function (n, u) {
        var s = u;
        if (s == null) s = self.location.href;
        if (n) {
            var g = new RegExp("(\\?|&)" + n + "=([^&|#]*)");
            var r = s.match(g);
            if (r) {
                try {
                    return decodeURIComponent(r[2]);
                } catch (err) {
                    return unescape(r[2]);
                }
            } else return null;
        } else {
            var i = s.indexOf("?");
            if (i === -1) return null;
            return s.substr(i + 1);
        }
    };
    //ÊâßË°åÊ†áÂáÜÂä®Áîª
    z.run = function (e) {
        if (window.requestAnimationFrame)
            return requestAnimationFrame(e);
        else
            return setTimeout(e, 1000 / 60);
    };
    //Ê†πÊçÆÂè•ÊüÑÂÅúÊ≠¢Âä®Áîª
    z.stop = function (h) {
        (window.cancelRequestAnimationFrame || clearTimeout)(h);
    };
    /*---------------------ÂéüÁîüÊîØÊåÅ-------------------------*/
    /*
    	Ë∑≥ËΩ¨Êñ∞È°µÈù¢
    	urlÔºö„ÄêÂøÖ„ÄëÈúÄË¶ÅË∑≥ËΩ¨ÁöÑÂú∞ÂùÄÔºå
    	cbÔºö„ÄêÈùû„Äë„Äê‰ªÖÂéüÁîüÊîØÊåÅ„ÄëÂΩìÈ°µÈù¢ÈáçÊñ∞ËøîÂõûÂêéÈúÄË¶ÅÊâßË°åÁöÑÊñπÊ≥ïÔºåÊâßË°åÈ°∫Â∫èÂú®resume‰πãÂêé	
    */
    z.go = function (url, cb) {
        if (z._pageinfo.test)
            url = AJAX.WebRoot() + url;
        if (z.w9()) {
            url = config.base + url;
            z._pageinfo.resume = cb;
            callNative('go', url);
        } else {
            url = config.base + url;
            var list = Comm.sdb(URLIST);
            if (list == null) list = [];
            list.push(self.location.href);
            z.sdb(URLIST, list);
            self.location.href = url;
        }
    };

    /* Comm.addMethod('gopage','url')
       gopage   godismiss   gologin
    **/
    /*Êñ∞Â¢ûÂéüÁîüÊñπÊ≥ï*/
    z.addMethod = function (m, d) {
        if (z.w9())
            callNative(m, d);
        else {
            if (m == "godismiss") Comm.close();
            if (m == "gologin") Comm.gotop("login.html");
        }
    };


    /**/
    z.goLogin2 = function (m, d) {
        Comm.goLogin();
    };


    /*
    	Ë∑≥ËΩ¨ÂéüÁîüÈ°µÈù¢
    	urlÔºö„ÄêÂøÖ„ÄëÈúÄË¶ÅË∑≥ËΩ¨ÁöÑÂú∞ÂùÄÔºå
    	cbÔºö„ÄêÈùû„Äë„Äê‰ªÖÂéüÁîüÊîØÊåÅ„ÄëÂΩìÈ°µÈù¢ÈáçÊñ∞ËøîÂõûÂêéÈúÄË¶ÅÊâßË°åÁöÑÊñπÊ≥ïÔºåÊâßË°åÈ°∫Â∫èÂú®resume‰πãÂêé
     */
    z.gopage = function (url, cb) {
        if (url == null) url = '';
        if (z.w9()) {
            url = config.base + url;
            z._pageinfo.resume = cb;
            callNative('gopage', url);
        } else {
            // url = config.base + url;
            // self.location.href = url;
            self.location.href = 'index.html';
        }
    };
    //Áõ¥Êé•Ë∑≥ËΩ¨Ôºå‰∏çÂºπÂá∫Êñ∞È°µÈù¢
    z.goself = function (url) {
        url = config.base + url;
        if (z._pageinfo.test)
            url = AJAX.WebRoot() + url;
        //Comm.message(url)
        self.location.href = url;
    };
    /*
    	ËøîÂõûÊ†àÈ°∂
    	url:„ÄêÂøÖ„Äë	Â¶ÇÊûúurl==‚Äò‚ÄôÁõ¥Êé•ËøîÂõûÊ†àÈ°∂,Â¶ÇÊûúurlÔºÅ=‚Äò‚ÄôÂÖ≥Èó≠Ê†à‰∏äÊâÄ‰ª•Â±ÇÔºåÊú¨È°µË∑≥ËΩ¨‰∏∫Êñ∞È°µÈù¢
    */
    z.gotop = function (url) {
        url = url || '';
        url = config.base + url;
        if (url == null) url = '';
        if (z._pageinfo.test)
            url = AJAX.WebRoot() + url;
        if (z.w9()) {
            callNative('gotop', url || '');
        } else {
            if (url === '') {
                var list = z.sdb(URLIST);
                if (list == null || list.length == 0)
                    return;
                url = list[0];
            }
            z.sdb(URLIST, []);
            self.location.href = url;
        }
    };
    //ÂÖ≥Èó≠È°µÈù¢cÈúÄË¶ÅËøîÂõûÁöÑÂ±ÇÊï∞ÔºåÈªòËÆ§‰∏∫1
    z.close = function (c) {
        if (c == null || c < 1) c = 1;
        if (z.w9()) callNative('close', c)
        else {
            var list = z.sdb(URLIST);
            var a;
            if (!(list == null || list.length === 0)) {
                for (var i = 0; i < c; i++)
                    a = list.pop();
                z.sdb(URLIST, list);
            }
            self.location.href = a ? a : config.base + ' index.html';
        }
    };
    //Âà§Êñ≠ÂΩìÂâçÁΩëÁªúÊòØÂê¶‰∏∫wifiÁéØÂ¢É
    z.isWiFi = function (cb) {
        if (z.w9()) callNative('isWiFi', setcb(cb));
    };
    //ÈÄöËøáÂéüÁîüÊâìÂç∞Êï∞ÊçÆ
    z.jslog = function (str, cb) {
        if (z.w9()) callNative('jslog', str);
    };
    //Ëé∑ÂèñÁºìÂ≠ò
    z.getCacheSize = function (cb) {
        if (z.w9()) callNative('getCacheSize', setcb(cb));
    };
    //Ê∏ÖÁêÜÁºìÂ≠ò
    z.clearCache = function (cb) {
        if (z.w9()) callNative('clearCache', setcb(cb));
    };
    //Ê≥®ÂÜåÊé®ÈÄÅ--state:1Ê≥®ÂÜå0Ê≥®ÈîÄ,token:ÁôªÂΩïtoken ,urlÔºöÁî®Êà∑device Êé•Âè£
    /*
    //Comm.registerPush({ state: 1, token: a.data.token, url: config.root + 'api/customer/device' });
    */
    z.registerPush = function (state, cb) {
        state.code = setcb(cb);
        if (z.w9())
            callNative('registerPush', state);
        else
            cb && cb(1);
    };
    //
    //ËÆæÁΩÆÊé®ÈÄÅ
    z.setPush = function (jsonObj, cb) {
        jsonObj['code'] = setcb(cb);
        if (z.w9()) callNative('setPush', jsonObj);
    };
    //‰∏ä‰º†ÂõæÁâá
    z.upimg = function (jsonObj, cb) {
        jsonObj['code'] = setcb(cb);
        if (z.w9()) {
            callNative('upimg', jsonObj)
        }
        //‰∏ä‰º†ÂõæÁâá
    };
    //Êâ´Êèè‰∫å‰∏ÄÁª¥Á†Å
    z.scanf = function (cb) {
        if (z.w9()) callNative('scanf', setcb(cb));
        if (Comm.isweixin()){

        }
    };

    z.goLogin = function (url, cb) {
        var jsonObj = url || 'login.html';
        if (z.w9()) {
            callNative('gologin', jsonObj);
        } else {
            self.location.href = config.SLTest ? 'zzzlogin.html' : 'login.html';
        }

        // if (Comm.isweixin()) {
        //     var url = config.SLShareBase + "/wxlogin.html?to=" + location.href;
        //     url = "https://open.weixin.qq.com/connect/oauth2/authorize?" +
        //         "appid=wx3d060683cbc1cbb7" +
        //         "&redirect_uri=" + encodeURIComponent(url) +
        //         "&response_type=code&scope=snsapi_userinfo&state=123#wechat_redirect";
        //     Comm.go(url);
        // }
    };

    z.godismiss = function (idx) {
        if (z.w9())
            callNative('godismiss', idx);
        else
            self.location.href = 'index.html';
    };

    //ÂÆö‰Ωç
    z.position = function (cb) {
        if (z.w9()) {
            callNative('position', setcb(cb));
        } else {
            var pmodel = {};
            pmodel.lat = UserJWD.lat();
            pmodel.lng = UserJWD.lng();
            pmodel.cityName = 'ÊàêÈÉΩ';
            pmodel.provinceName = 'ÂõõÂ∑ùÁúÅ';
            pmodel.district = 'Ê≠¶‰æØÂå∫';
            pmodel.code = '1';
            cb && cb(pmodel);
        }
    };
    //‰ªéÂú∞Âõæ‰∏äÈÄâÊã©ÁÇπ,Â¶ÇÊûúÊòØÂæÆ‰ø°ÂàôÈúÄË¶ÅÂú∞ÂõæÂÆπÂô®box
    z.selectPosition = function (cb, box) {
        if (z.w9()) callNative('selectPosition', setcb(cb));
        else Map.show(box, cb);
    };
    z.shareUrl = function (jsonObj, cb) {
        jsonObj['code'] = setcb(cb);
        if (z.w9()) {
            callNative('shareUrl', jsonObj)
        } else {
            if (Comm.isweixin()){
                Share.start(jsonObj);
            }
        }
        ;
    };

    //‰∏ÉÈ±ºÂÆ¢Êúç
    z.qiyu = function (jsonObj) {
        if (z.w9()) callNative('qiyu', jsonObj);
    };
    //ÂéüÁîüÁΩëÁªúËØ∑Ê±Çget
    z.get = function (jsonObj, cb) {
        jsonObj['code'] = setcb(cb);
        if (z.w9()) callNative('get', jsonObj);
    };
    //ÂéüÁîüÁΩëÁªúËØ∑Ê±Çpost
    z.postData = function (jsonObj, cb) {
        jsonObj['code'] = setcb(cb);
        if (z.w9()) callNative('postData', jsonObj);
    };
    //Êï∞ÊçÆËé∑Âèñ
    z.storage = function (key, cb) {
        if (z.w9())
            callNative('storage', {
                key: key,
                code: setcb(cb, true)
            });
        else if (cb) {
            cb(z.db(key));
        }
    };
    //ËÆæÁΩÆÁºìÂ≠òÊï∞ÊçÆ,Â¶ÇÊûúvalue=nullÔºåÂàôÂà†Èô§ÂØπË±°
    z.storageValue = function (key, value, cb) {
        if (z.w9()) {
            if (value != null) {
                if (z.ios()) {
                    value = enData(value);
                }
            }
            // value = JSON.stringify(value);
            callNative('storageValue', {
                key: key,
                value: value,
                code: (cb ? setcb(cb) : '')
            });
        } else {
            z.db(key, value);
            cb && cb();
        }
    };
    //ËÆæÁΩÆÊâãÊú∫ËΩ¨Âêë
    z.rotate = function (value) {
        //1ÂÄºÁ´ñÂêëÂ±ïÁ§∫„ÄêÈªòËÆ§„Äë,	2Ê®™ÂêëÂ±ïÁ§∫
        if (z.w9()) callNative('rotate', value === 1 ? 1 : 2);
    };
    //ÊèêÁ§∫Ê°Ü
    z.alert = function (mess, cb) {
        if (mess == null || mess === "") return;
        var a = {
            code: setcb(cb),
            mess: mess
        };
        if (z.w9()) callNative('alert', a);
        else Mess.alert(mess, a.code);
    };
    //Á°ÆËÆ§Ê°Ücb ÂõûË∞ÉËøîÂõûÂèÇÊï∞‰∏∫1 Ë°®Á§∫Á°ÆËÆ§
    z.confirm = function (mess, cb, o) {
        if (mess == null || mess === "") return;
        var a = {
            code: setcb(cb),
            mess: mess
        };
        if (z.w9()) callNative('confirm', a);
        else Mess.confirm(mess, a.code, o);
    };
    z.setcb = setcb;
    z.Mess = Mess;
    //ÊèêÁ§∫Ê∂àÊÅØ
    z.message = function (mess) {
        if (z.w9()) callNative('message', mess);
        else Message.show(mess);
    };
    z.debugMessage = function (mess) {
        if (!config.SLTest) return;
        Comm.message(mess);
    };

    z.saveImg = function (jsonObj, cb) {
        jsonObj['code'] = setcb(cb);
        if (z.w9()) {
            callNative('saveImg', jsonObj);
        }
    }

    //Á¨¨‰∏âÊñπÁôªÂΩï jsonObj={typeÔºö1}:Âá≠ËØÅÁ±ªÂà´ 1ÂæÆ‰ø°Ôºå2QQ,3,f,4t
    /**
     *
     * Comm.extLogin({ type: type }, function (data) {
            if (data.code == 1) {
                Comm.loading("Ê≠£Âú®ÁôªÂΩï");
                AJAX.POST("/common/customer/otherLogin", {
                    openid: data.openid,
                    uid: data.unionid,
                    loginType: type,
                    clientType: 2,
                    customerName: data.nickname,
                    headPort: data.face
                }, function (a) {
                    Comm.loading(false);
                    if (a.code == 1) {
                        Comm.message('ÁôªÂΩïÊàêÂäü');
                        if (a.data.phone == "") {
                            Comm.go("newBindPhone.html");
                        } else if (a.data.data.identity == "0") {
                            Comm.go("regnext.html")
                        }
                        Comm.gotop("index.html")
                    } else {
                        Comm.message(a.msg);
                    }
                });
            }
        });
     *
     */
    z.extLogin = function (jsonObj, cb) {
        if (z.w9()) {
            jsonObj['code'] = setcb(cb);
            callNative('extLogin', jsonObj);
        }
    };
    //ÊîØ‰ªò
    z.pay = function (jsonObj, cb) {

        jsonObj['code'] = setcb(cb);
        if (z.w9()) {
            callNative('pay', jsonObj);
        } else if (Comm.isweixin()) {
            jsonObj.openId = Comm.db('openid');
            var url =  jsonObj.url.replace(config.root,'');
            AJAX.POST(url, jsonObj, function (d) {
                if (d.code == 1) {
                    WXMethod.pay(d.data, function (d) {
                        cb && cb(d);
                    })
                } else {
                    Comm.alert(JSON.stringify(d));
                    cb && cb({ code: 0, msg: 'ÊîØ‰ªòÂ§±Ë¥•api'});
                }
            })
        }
    };
    //ËÆæÂ§á‰ø°ÊÅØ
    z.deviceInfo = function (cb) {
        if (z.w9()) callNative('deviceInfo', setcb(cb));
    };
    //Ëé∑ÂèñÁî®Êà∑ÈÄöËÆØÂΩï
    z.getAddressBook = function (cb) {
        if (z.w9()) callNative('getAddressBook', setcb(cb));
    };
    //ÊñáÊú¨Â§çÂà∂
    z.copyText = function (str) {
        if (z.w9()) callNative('copyText', str);
    };
    //Ëé∑ÂèñËΩØ‰ª∂ÁâàÊú¨Âè∑
    z.getVersion = function (cb) {
        if (z.w9()) callNative('getVersion', setcb(cb));
    };
    //Ëé∑Âèñtoken
    z.getPushToken = function (cb) {
        if (z.w9()) callNative('getPushToken', setcb(cb));
    };
    //ÊâìÂºÄÂ§ñÈÉ®ÊµèËßàÂô®
    z.openUrlStr = function (url) {
        if (z.w9()) callNative('openUrlStr', url)
        else Comm.goself(url);
    };
    /*ËÆæÁΩÆandroidÂèØÈ¶ñÈ°µ‰∫ã‰ª∂*/
    z.setAndroidHome = function () {
        z._pageinfo.android_home = 1;
    };
    //Ë∞ÉÁî®ÊñπÊ≥ïComm.OSS.getImgUrl(uri,'1');ÂõæÁâáÂâçÁºÄÊõ¥Êñ∞ÊñπÊ≥ï
    z.OSS = {
        /*ÈòøÈáå‰∫ëossÂ∑•ÂÖ∑*/
        host: function () {
            return window['config'] && window.config['ossroot'] ? config.ossroot : '';
        },
        /*ossËÆøÈóÆÂú∞ÂùÄ*/
        /*
        Ëé∑ÂèñÂõæÁâáËÆøÈóÆÂú∞ÂùÄ
        uri:Êï∞ÊçÆÂ∫ì‰∏≠‰øùÂ≠òÁöÑÊñá‰ª∂Âú∞ÂùÄ
        type:ÊòæÁ§∫Á±ªÂûã 	ÂèñÂÄº:s|m|l
         */
        getImgUrl: function (uri, type) {
            if (uri == null && !uri)
                return "-----------error";
            if (uri.length >= 4 && uri.indexOf("http") > -1)
                return uri;
            var url = z.OSS.host() + uri;
            if (type) {
                switch (type) {
                    case 'd':
                        url += '';
                        break;
                    case 'l':
                        url += "/";
                        url += '800';
                        break;
                    case 'f':
                        url += "/";
                        url += '400';
                        break;
                    case 'm':
                        url += "/";
                        url += '250';
                        break;
                    case 's':
                        url += "/";
                        url += '120';
                        break;
                }
            }
            return url;
        }
    };
    /*------------UIÂÖ¨ÂÖ±ÂáΩÊï∞------------------------*/
    //ÊòæÁ§∫Èó®ËíôÂ±Ç Z-indexÔºåËØ∑Êü•ÁúãCSS=999ÔºåÁî±ËÆ°Êï∞Âô®ÊéßÂà∂ÂÖ≥Èó≠ÔºåclsÊòØÂê¶Âº∫Âà∂ÂÖ≥Èó≠Ôºå
    //Â¶ÇÊûúË¶ÅÊòæÁ§∫Âú®‰∏äÂ±ÇÔºåËØ∑Â∞Ü z-indexË∞ÉÂà∞Êõ¥È´ò
    z.bg = function (show, cls) {
        if (cls)
            MainBg.close();
        else
            MainBg.show(show);
    };
    /*wtdid:Ê®°Êùøid ,<div id="sinbox" wtd="Ê®°ÊùøID"></div>
    cancelÔºöÁÇπÂáªËÉåÊôØÊòØÂê¶ÂèØ‰ª•ÂèñÊ∂à*/
    z.showWindow = function (wtdid, cancel) {
        if (wtdid) {
            WTD.show(wtdid, cancel);
            Comm.iosInput();
        } else WTD.hide();
    };
    /*sÁõ∏ÂΩì‰∫élocalStorage,Â¶ÇÊûúÁî®‰∫éÂéüÁîüpage‰πãÈó¥ÂÖ±‰∫´Êï∞ÊçÆÔºåËØ∑storate*/
    z.db = function (t, v) {
        if (v == null) {
            if (arguments.length === 1) {
                return z._deData(localStorage[t]);
            } else {
                localStorage.removeItem(t);
            }
        } else {
            localStorage[t] = enData(v);
        }
    };
    /*Áõ∏ÂΩì‰∫ésessionStorage,Áî®‰∫é‰ºöËØùÂ≠òÂÇ®Ôºå‰∏çÂèØ‰Ωú‰∏∫ÊåÅ‰πÖÂ≠òÂÇ®*/
    z.sdb = function (t, v) {
        if (v == null) {
            return z._deData(sessionStorage[t]);
        }
        sessionStorage[t] = enData(v);
    };
    /*‰∏ªÂä®ÂºπÂá∫Âä†ËΩΩÊïàÊûú
    arg,ÊòæÁ§∫ÊñáÂ≠óÔºåÂ¶ÇÊûú‰∏ç‰º†ÂÖ•ÂàôË°®Á§∫ÂÖ≥Èó≠ */
    z.loading = function (arg) {
        Loading.show(arg);
    };
    //Áªü‰∏ÄÁÆ°ÁêÜË∞ÉËØïËæìÂá∫ÔºåÂèëÂ∏ÉÊó∂Ôºå‰∏ÄÈîÆÂ±èËîΩ
    z.log = function (v) {
        console.log(v);
    };
    /*Áî®‰∫éÂä†ËΩΩÂà∑Êñ∞Âà∑Êñ∞ÊåâÈíÆ*/
    z.showreload = function () {
        var b = document.createElement('button');
        b.classList.add('testRefBtn')
        b.setAttribute("style", "z-index:999999;position:fixed;top:50%;left:20px;width:45px");
        b.onclick = function () {
            document.location.reload()
        };
        b.innerHTML = "Âà∑Êñ∞";
        document.body.appendChild(b);
    };
    //ËÆ°ÁÆóÊ°ÜÊû∂È´òÂ∫¶
    z.resizeSection = function () {

        // return;
        var headSel = '.navBar';
        var isX = Comm.db('isX');
        //Âà§Êñ≠ÂÆâÂçìËøòÊòØios
        if (Comm.ios() && !isX) { //Â¶ÇÊûúÊòØios Â§¥ÈÉ®padding
            $(headSel).css("padding-top", "20px");
        } else if (Comm.ios() && isX){
            $(headSel).css("padding-top", "40px");
        }

        var h = Comm.$1('body >header'),
            f = Comm.$1('body >footer'),
            s = Comm.$1('body >section');
        if (s) {
            s.style.height = (window.innerHeight - (h ? h.offsetHeight : 0) - (f ? f.offsetHeight : 0)) + 'px';
        }

        // Comm.storage("isX", function (d) {
        //     if (parseInt(d) == 1) {
        //         Comm.db('isX',true);
        //         $("headSel").css("padding-top", "0px");
        //         s.style.height = (window.innerHeight - (h ? h.offsetHeight : 0) - (f ? f.offsetHeight : 0)) + 'px';
        //     }
        // })

    };
    /*
        Ë∑≥ËΩ¨Á¨¨‰∏âÊñπÂú∞ÂõæÂØºËà™
        { lat: Á∫¨Â∫¶, lng: ÁªèÂ∫¶, addr: 'ËØ¶ÁªÜÂú∞ÂùÄ' }
    */
    z.navigation = function (obj) {
        if (z.w9())
            callNative("navigation", obj);
        else {
            console.log('navigation');
            // openMapApp(obj.lat, obj.lng, obj.addr)
            Comm.go("navigation.html?lat=" + obj.lat + "&lng=" + obj.lng + "&addr=" + obj.addr)
        }
    };
    /*Â§ÑÁêÜ‰∫ë‰ø°*
        data={appid:1,yunxin_token:11}
    */
    z.getYXlogin = function (jsonObj, cb) {
        jsonObj.code = setcb(cb);
        if (z.w9()) {
            callNative('getYXlogin', jsonObj);
        } else {
            cb && cb()
        }
    };
    z.getYXcontact = function (appid, cb) {
        if (z.w9()) {
            callNative('getYXcontact', {
                appid: appid
            });
        } else {
            Comm.go('chat.html?toid=' + appid)
        }
    };
    z.openMap = function (jsonObj, cb) {
        jsonObj.code = setcb(cb);
        if (z.w9()) {
            callNative('openMap', jsonObj);
        }
    };
    /*
     * ÈöèÊú∫ÁîüÊàêÂ≠óÁ¨¶‰∏≤
     */
    z.randomWord = function () {
        var str = 'xxxxxxxx-4xxxx-yxxx';
        var code = str.replace(/[xy]/g, function (c) {
            var r = Math.random() * 16 | 0,
                v = c == 'x' ? r : (r & 0x3 | 0x8);
            return v.toString(16);
        });
        return code.replace(/-/g, "").toUpperCase();
    };
    /*
     * jsonÊï∞ÁªÑÊéíÂ∫è(ÂèÇÊï∞Âê´‰πâ,ÈªòËÆ§ÈôçÂ∫è)
     * json: ÈúÄË¶ÅÊéíÂ∫èÁöÑjosnÂØπË±°
     * key: Ê†πÊçÆjosnÊéíÂ∫èÁöÑÂ≠óÊÆµÂêç
     * bool: true-->ÂçáÂ∫è   false-->ÈôçÂ∫è
     */
    z.jsonSort = function (json, key, bool) {
        var i;
        for (var j = 1, jl = json.length; j < jl; j++) {
            var temp = json[j],
                val = temp[key],
                i = j - 1;
            if (bool) {
                while (i >= 0 && json[i][key] > val) {
                    json[i + 1] = json[i];
                    i = i - 1;
                }
            } else {
                while (i >= 0 && json[i][key] <= val) {
                    json[i + 1] = json[i];
                    i = i - 1;
                }
            }
            json[i + 1] = temp;
        }
        return json;
    };
    //ÊâìÂç∞Èù¢Âçï jsonObj:{type:1,data:d};
    z.bluetoothPrint = function (jsonObj, cb) {
        jsonObj.code = setcb(cb);
        if (z.w9()) {
            callNative('bluetoothPrint', jsonObj);
        }
    };
    //Âà§Êñ≠ÊòØÂê¶ÊòØÂæÆ‰ø°
    z.isweixin = function () {
        var ua = navigator.userAgent.toLowerCase(); //Ëé∑ÂèñÂà§Êñ≠Áî®ÁöÑÂØπË±°
        if (ua.match(/MicroMessenger/i) == "micromessenger") {
            return true;
        }
        if (ua.match(/WeiBo/i) == "weibo") {
            //Âú®Êñ∞Êµ™ÂæÆÂçöÂÆ¢Êà∑Á´ØÊâìÂºÄ
        }
        if (ua.match(/QQ/i) == "qq") {
            //Âú®QQÁ©∫Èó¥ÊâìÂºÄ
        }
        return false;
    };
    z.iosInput = function () {
        if (Comm.ios() || Comm.isweixin()) {
            var inputs = document.querySelectorAll("input");
            for (var i = 0; i < inputs.length; i++) {
                var item = inputs[i];
                item.onblur = function () {
                    setTimeout(function () {
                        if (document.activeElement.tagName == 'INPUT') {
                            return;
                        } else {
                            document.activeElement.scrollIntoViewIfNeeded(true);
                        }
                    }, 100);
                }
            }
            var textareas = document.querySelectorAll("TEXTAREA");
            for (var i = 0; i < textareas.length; i++) {
                var item = textareas[i];
                item.onblur = function () {
                    setTimeout(function () {
                        if (document.activeElement.tagName == 'TEXTAREA') {
                            return;
                        } else {
                            document.activeElement.scrollIntoViewIfNeeded(true);
                        }
                    }, 100);
                }
            }
        }
    };
    z.parseActType = function (actType) {
        if (actType == 1) {
            return 'ÂÖÖÂÄº';
        } else if (actType == 2) {
            return 'Ë¥≠‰π∞‰ºöÂëò';
        } else if (actType == 3) {
            return 'ËÆ¢Âçï‰ªòÊ¨æ';
        } else if (actType == 4) {
            return 'Êé®ËçêÂ•ñÂä±';
        } else if (actType == 5) {
            return '‰Ω£Èáë';
        } else if (actType == 6) {
            return 'Âπ≥Âè∞Ë°•Âä©';
        } else if (actType == 7) {
            return 'Â∑ÆÈ¢ù';
        } else if (actType == 8) {
            return 'ÊèêÁé∞';
        } else if (actType == 9) {
            return 'Âπ≥Âè∞Â•ñÂä±';
        } else if (actType == 10) {
            return 'Â∫óÈì∫‰ªòÊ¨æ';
        } else if (actType == 11) {
            return 'Âêà‰ºô‰∫∫ËøòÂä†ÁõüË¥π';
        } else if (actType == 12) {
            return 'ÂàÜÊ∂¶';
        } else if (actType == 13) {
            return 'Ê≥®ÂÜå';
        } else if (actType == 14) {
            return 'Êä¢Á∫¢ÂåÖ';
        } else if (actType == 15) {
            return 'ÂîÆÂêéÈÄÄÊ¨æ';
        } else if (actType == 16) {
            return 'ÊèêÁé∞ÈÄÄÊ¨æ';
        } else {
            return 'Êú™Áü•';
        }
    }
};


/*ËÆæÁΩÆandroidËæìÂÖ•Ê°Ü‰∫ã‰ª∂ÔºåÂú®ÈúÄË¶ÅÂ§ÑÁêÜÁöÑËæìÂÖ•Ê°ÜÂÆåÊàêÂêéË∞ÉÁî®Âç≥ÂèØ*/
function setAndroidKeyboard(ele, sheight) {
    (sheight == null) && (sheight = 0);
    if (Comm.weiLai() && !Comm.iOS() && !window.androidKb) {
        window.androidKb = {
            section: null,
            input: null,
            f: function (f) {
                window.androidKb.input = f.target;
            },
            b: function (b) {
                setTimeout(function () {
                    window.androidKb.input = null;
                }, 300)
            }
        };
        window.keyBoardEvent = function (show, ratio) {
            if (window.androidKb.input && window.androidKb.section) {
                if (show) {
                    var keyboardHeihgt = window.innerHeight * ratio + sheight;
                    var inputBottom = window.innerHeight - window.androidKb.input.getBoundingClientRect().bottom;
                    if (inputBottom < keyboardHeihgt) {
                        window.androidKb.section.style.transform = "translate(0px,-" + (keyboardHeihgt - inputBottom) + "px)";
                    }
                } else {
                    $("input,textarea").blur();
                    window.androidKb.section.style.transform = "translate(0px,0px)";
                }
            }
        };
    }
    if (window.androidKb) {
        window.androidKb.section = ele ? ele : document.getElementsByTagName("section")[0];
        $("input,textarea").unbind(window.androidKb.f).focus(window.androidKb.f);
        $("input,textarea").unbind(window.androidKb.b).blur(window.androidKb.b);
    }
}

function resumeAndroidKeyboard() {
    if (window.androidKb && window.androidKb.section)
        window.androidKb.section.style.transform = "translate(0px,0px)";
}

//Âä†ËΩΩÊàêÂäüÔºåÂà∑Êñ∞È´òÂ∫¶
if (document.addEventListener) {
    document.addEventListener("DOMContentLoaded", Comm.resizeSection, false);
}
//ÂàùÂßãÂåñÈ°µÈù¢
window.onload = function () {
    if (window['config'] && config['isTest'] != null) Comm._pageinfo.test = config['isTest'];

    Comm.resizeSection();
    if (Comm._pageinfo.test) {
        Comm.showreload();
        window.onerror = function (e) {
            // Comm.message('ËÑöÊú¨ÈîôËØØ:' + e)
        }
    }

    Comm.exec("pageload");
    Comm.iosInput();
};
//Ëß£ÂÜ≥ÂºπÂá∫ÈîÆÁõòÈÅÆÊå°ËæìÂÖ•Ê°Ü
window.addEventListener("resize", function () {
    if (document.activeElement.tagName == "INPUT" || document.activeElement.tagName == "TEXTAREA") {
        window.setTimeout(function () {
            document.activeElement.scrollIntoView(true);
            document.activeElement.scrollIntoViewIfNeeded(true);
        }, 100);
    }
    Comm.resizeSection();
    window.onresize = Comm.resizeSection;
})


var flagKeyBoardShow = false;
document.addEventListener('focusin', function () {
    flagKeyBoardShow = true;
    //console.log('focusin' + window.innerHeight);
});

document.addEventListener('focusout', function () {

    //console.log('focusout' + window.innerHeight);

    // setTimeout(function () {
    //     if (flagKeyBoardShow) return;
    //     $(window).scrollTop(0);
    // },100);
    $(window).scrollTop(0);
    flagKeyBoardShow = false;
})


//Ëß£ÂÜ≥ËøîÂõûÊåâÈíÆ--ÈíàÂØπÂæÆ‰ø°
//window.onpageshow = function (e) {if (e.persisted)window.location.reload(true)}

var v = Comm.db('AppVersion');
if (!v) {
    var args = Array.prototype.slice.call(document.querySelectorAll('script'));

    function _refreshVersion(event) {
        args.forEach(function (script, i) {
            var src = script.src;
            src += (src.indexOf('?') > 0 ? '&' : '?') + 'v=' + v;
            script.src = src;
        });
    }

    if (document.addEventListener) {
        document.addEventListener("DOMContentLoaded", _refreshVersion, false);
    } else if (typeof window['$'] === 'function') {
        $(document).ready(_refreshVersion);
    }
}
